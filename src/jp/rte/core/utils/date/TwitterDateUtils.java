package jp.rte.core.utils.date;

import java.util.Calendar;
import java.util.Date;

import org.slim3.util.DateUtil;

public class TwitterDateUtils {

    public static String makeTwitterDate(Date date) {
        Date now = new Date();
        Long diff = now.getTime() - date.getTime();

        if (diff < 1000 * 60) {
            return Math.round(diff / 1000) + "秒前";
        } else if (diff < 1000 * 60 * 60) {
            return Math.round(diff / (1000 * 60)) + "分前";
        } else if (diff < 1000 * 60 * 60 * 24) {
            return "約" + Math.round(diff / (1000 * 60 * 60)) + "時間前";
        } else {
            Calendar calendar = DateUtil.toCalendar(date);
            Calendar now_calendar = DateUtil.toCalendar(now);

        //    var monthAry = ['Jan', 'Feb', 'Mar', 'Apl', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            int hour = calendar.get(Calendar.HOUR);
            String ampm = " AM ";
            if (hour > 12) {
                hour = hour - 12;
                ampm = " PM ";
            }
            int minutes = calendar.get(Calendar.MINUTE);
            String minutes_str = null;
            if (minutes < 10) {
                minutes_str = "0" + String.valueOf(minutes);
            }else{
                minutes_str = String.valueOf(minutes);
            }
            int day = calendar.get(Calendar.DATE);
            String prefix = "th";
            switch (day) {
            case 1 :
            case 21 :
            case 31 :
                prefix = "st";
                break;
            case 2 :
            case 22 :
                prefix = "nd";
                break;
            case 3 :
            case 23 :
                prefix = "rd";
                break;
            }
            String year = "";
            if (now_calendar.get(Calendar.YEAR) != calendar.get(Calendar.YEAR)) {
                year = ", " + String.valueOf(calendar.get(Calendar.YEAR));
            }
            return String.valueOf(hour) + ":" + minutes_str + ampm
                + calendar.get(Calendar.DAY_OF_WEEK) + ' '
                + String.valueOf(day) + prefix + year;
        }
    }
}
